---
import BaseHead from '@component/Head/BaseHead.astro'
import TopBarNav from '@component/Navigation/TopBar.astro'
import HomeHead from '@component/Head/HomeHead.astro'
import Card from '@component/Content/Card.astro'
import Footer from '@component/Footer/Footer.astro'
import Paginator from '@component/Content/Paginator.astro'
import { Settings } from '@config/site'
import { getCollection } from 'astro:content'
import type { GetStaticPathsOptions, InferGetStaticPropsType } from 'astro'

export const prerender = true

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const allPosts = await getCollection('posts')

  const sortedPosts = allPosts.sort(
    (a, b) =>
      new Date(b.data.pubDate).valueOf() - new Date(a.data.pubDate).valueOf(),
  )

  return paginate(sortedPosts, { pageSize: 21 })
}

type Props = InferGetStaticPropsType<typeof getStaticPaths>
const { page }: Props = Astro.props
const seoTitle = `Articles | ${Settings.site.title}`
const seoDescription =
  'Browse all articles on Coder Rocks — the agentic engineering blog for AI-assisted development and modern engineering.'
---

<html lang="en">
  <head>
    <BaseHead
      title={seoTitle}
      description={seoDescription}
      paginationPrev={page.url.prev || undefined}
      paginationNext={page.url.next || undefined}
    />
  </head>

  <body
    class="font-body personality-casual bg-white leading-normal text-black dark:bg-slate-900 dark:text-slate-100"
    data-pagefind-ignore="all"
  >
    <TopBarNav />

    <main
      class="bg-gradient-to-b from-zinc-50 to-white py-12 dark:from-slate-900 dark:to-slate-800"
    >
      <article class="mx-auto max-w-6xl px-4">
        <HomeHead showLogo={true} />
        <div class="mt-1 mb-8 flex items-center gap-4">
          <div class="h-px flex-1 bg-zinc-200 dark:bg-slate-700"></div>
          <div class="flex items-center gap-2.5">
            <span
              class="text-base font-medium tracking-wider text-zinc-500 uppercase dark:text-slate-400"
              >Articles</span
            >
            <span
              class="inline-flex h-6 min-w-6 items-center justify-center rounded-full bg-sky-100 px-2 text-sm font-bold text-sky-700 dark:bg-sky-900 dark:text-sky-300"
              >{page.total}</span
            >
            {
              page.lastPage > 1 && (
                <span class="text-xs text-zinc-400 dark:text-slate-500">
                  · pg {page.currentPage}/{page.lastPage}
                </span>
              )
            }
          </div>
          <div class="h-px flex-1 bg-zinc-200 dark:bg-slate-700"></div>
        </div>

        <section
          class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3"
          data-test="articles-section"
        >
          {
            page.data.map(post => (
              <div class="col-span-1">
                <Card post={post} />
              </div>
            ))
          }
        </section>
      </article>
    </main>
    <Paginator page={page} />
    <Footer />
  </body>
</html>
